<?xml version="1.0" encoding="UTF-8"?>
<pipeline>
  <info>
    <name>SEQ_API_Arquivei_nfse</name>
    <name_sync_with_filename>Y</name_sync_with_filename>
    <description/>
    <extended_description/>
    <pipeline_version/>
    <pipeline_type>Normal</pipeline_type>
    <parameters>
    </parameters>
    <capture_transform_performance>N</capture_transform_performance>
    <transform_performance_capturing_delay>1000</transform_performance_capturing_delay>
    <transform_performance_capturing_size_limit>100</transform_performance_capturing_size_limit>
    <created_user>-</created_user>
    <created_date>2024/07/08 16:57:52.196</created_date>
    <modified_user>-</modified_user>
    <modified_date>2024/07/08 16:57:52.196</modified_date>
  </info>
  <notepads>
  </notepads>
  <order>
    <hop>
      <from>JSON input</from>
      <to>JavaScript</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>JavaScript</from>
      <to>Select values</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select values</from>
      <to>Get data from XML</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Get data from XML</from>
      <to>Parquet File Output arquivei nfse</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Calculator</from>
      <to>Set variables parametros 1 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Formula</from>
      <to>Set variables parametros 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>JSON input data</from>
      <to>Merge join</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>JSON input next</from>
      <to>Formula</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Merge join</from>
      <to>Write to log</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Set variables parametros 2</from>
      <to>Merge join</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Switch / case</from>
      <to>Calculator</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Write to log</from>
      <to>Switch / case</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Get variables</from>
      <to>REST client 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Parametros API arquivei</from>
      <to>Get variables</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>REST client 2</from>
      <to>JSON input data</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Switch / case</from>
      <to>JSON input</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>REST client 2</from>
      <to>JSON input next</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <transform>
    <name>Calculator</name>
    <type>Calculator</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <calculation>
      <calc_type>CONSTANT</calc_type>
      <field_a>0</field_a>
      <field_name>id_url_break</field_name>
      <remove>N</remove>
      <value_length>-1</value_length>
      <value_precision>-1</value_precision>
      <value_type>String</value_type>
    </calculation>
    <failIfNoFile>Y</failIfNoFile>
    <attributes/>
    <GUI>
      <xloc>1632</xloc>
      <yloc>352</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Formula</name>
    <type>Formula</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <formulas>
      <formula>
        <formula>[id_arquivo]+1</formula>
        <replace_field>id_arquivo</replace_field>
        <value_length>-1</value_length>
        <value_precision>-1</value_precision>
        <value_type>5</value_type>
      </formula>
    </formulas>
    <attributes/>
    <GUI>
      <xloc>912</xloc>
      <yloc>416</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Get data from XML</name>
    <type>getXMLData</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <include>N</include>
    <include_field/>
    <rownum>N</rownum>
    <addresultfile>N</addresultfile>
    <namespaceaware>N</namespaceaware>
    <ignorecomments>Y</ignorecomments>
    <readurl>N</readurl>
    <validating>N</validating>
    <usetoken>N</usetoken>
    <IsIgnoreEmptyFile>N</IsIgnoreEmptyFile>
    <doNotFailIfNoFile>Y</doNotFailIfNoFile>
    <rownum_field/>
    <encoding>UTF-8</encoding>
    <file>
      <name>C:\opt\nfse_prod.xml</name>
      <filemask/>
      <exclude_filemask/>
      <file_required>N</file_required>
      <include_subfolders>N</include_subfolders>
    </file>
    <fields>
      <field>
        <name>Numero_NF</name>
        <xpath>*[name()='InfNfse']/*[name()='Numero']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>Integer</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>CodigoVerificacao</name>
        <xpath>*[name()='InfNfse']/*[name()='CodigoVerificacao']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>DataEmissao</name>
        <xpath>*[name()='InfNfse']/*[name()='DataEmissao']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>BaseCalculo</name>
        <xpath>*[name()='InfNfse']/*[name()='ValoresNfse']/*[name()='BaseCalculo']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>Aliquota</name>
        <xpath>*[name()='InfNfse']/*[name()='ValoresNfse']/*[name()='Aliquota']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>ValorIss</name>
        <xpath>*[name()='InfNfse']/*[name()='ValoresNfse']/*[name()='ValorIss']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>ValorLiquidoNfse</name>
        <xpath>*[name()='InfNfse']/*[name()='ValoresNfse']/*[name()='ValorLiquidoNfse']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>CpfCnpj</name>
        <xpath>*[name()='InfNfse']/*[name()='PrestadorServico']/*[name()='IdentificacaoPrestador']/*[name()='CpfCnpj']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>InscricaoMunicipal</name>
        <xpath>*[name()='InfNfse']/*[name()='PrestadorServico']/*[name()='IdentificacaoPrestador']/*[name()='InscricaoMunicipal']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>RazaoSocial</name>
        <xpath>*[name()='InfNfse']/*[name()='PrestadorServico']/*[name()='RazaoSocial']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>Endereco</name>
        <xpath>*[name()='InfNfse']/*[name()='PrestadorServico']/*[name()='Endereco']/*[name()='Endereco']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>Numero</name>
        <xpath>*[name()='InfNfse']/*[name()='PrestadorServico']/*[name()='Endereco']/*[name()='Numero']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>Bairro</name>
        <xpath>*[name()='InfNfse']/*[name()='PrestadorServico']/*[name()='Endereco']/*[name()='Bairro']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>CodigoMunicipio</name>
        <xpath>*[name()='InfNfse']/*[name()='PrestadorServico']/*[name()='Endereco']/*[name()='CodigoMunicipio']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>Uf</name>
        <xpath>*[name()='InfNfse']/*[name()='PrestadorServico']/*[name()='Endereco']/*[name()='Uf']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>Cep</name>
        <xpath>*[name()='InfNfse']/*[name()='PrestadorServico']/*[name()='Endereco']/*[name()='Cep']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>Contato</name>
        <xpath>*[name()='InfNfse']/*[name()='PrestadorServico']/*[name()='Contato']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>DeclaracaoPrestacaoServico</name>
        <xpath>*[name()='InfNfse']/*[name()='DeclaracaoPrestacaoServico']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>CpfCnpj_tomador</name>
        <xpath>*[name()='InfNfse']/*[name()='DeclaracaoPrestacaoServico']/*[name()='InfDeclaracaoPrestacaoServico']/*[name()='Tomador']/*[name()='IdentificacaoTomador']/*[name()='CpfCnpj']/*[name()='Cnpj']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>RazaoSocial_tomador</name>
        <xpath>*[name()='InfNfse']/*[name()='DeclaracaoPrestacaoServico']/*[name()='InfDeclaracaoPrestacaoServico']/*[name()='Tomador']/*[name()='RazaoSocial']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>email_tomador</name>
        <xpath>*[name()='InfNfse']/*[name()='DeclaracaoPrestacaoServico']/*[name()='InfDeclaracaoPrestacaoServico']/*[name()='Tomador']/*[name()='Contato']/*[name()='Email']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>Valor_Servico</name>
        <xpath>*[name()='InfNfse']/*[name()='DeclaracaoPrestacaoServico']/*[name()='InfDeclaracaoPrestacaoServico']/*[name()='Servico']/*[name()='Valores']/*[name()='ValorServicos']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>None</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>Discriminacao</name>
        <xpath>*[name()='InfNfse']/*[name()='DeclaracaoPrestacaoServico']/*[name()='InfDeclaracaoPrestacaoServico']/*[name()='Servico']/*[name()='Discriminacao']</xpath>
        <element_type>node</element_type>
        <result_type>valueof</result_type>
        <type>None</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
    </fields>
    <limit>0</limit>
    <loopxpath>/*[name()='CompNfse']/*[name()='Nfse']</loopxpath>
    <IsInFields>Y</IsInFields>
    <IsAFile>N</IsAFile>
    <XmlField>xml_decoded</XmlField>
    <prunePath/>
    <shortFileFieldName/>
    <pathFieldName/>
    <hiddenFieldName/>
    <lastModificationTimeFieldName/>
    <uriNameFieldName/>
    <rootUriNameFieldName/>
    <extensionFieldName/>
    <sizeFieldName/>
    <attributes/>
    <GUI>
      <xloc>2144</xloc>
      <yloc>144</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Get variables</name>
    <type>GetVariable</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <length>-1</length>
        <name>url_paginada</name>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <type>String</type>
        <variable>${URL_Next_Arquivei_nfse}</variable>
      </field>
      <field>
        <length>-1</length>
        <name>id_arquivo</name>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <type>Integer</type>
        <variable>${ID_REF_GERAL}</variable>
      </field>
    </fields>
    <attributes/>
    <GUI>
      <xloc>384</xloc>
      <yloc>272</yloc>
    </GUI>
  </transform>
  <transform>
    <name>JSON input</name>
    <type>JsonInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <include>N</include>
    <include_field/>
    <rownum>N</rownum>
    <addresultfile>N</addresultfile>
    <readurl>N</readurl>
    <removeSourceField>N</removeSourceField>
    <IsIgnoreEmptyFile>N</IsIgnoreEmptyFile>
    <doNotFailIfNoFile>Y</doNotFailIfNoFile>
    <ignoreMissingPath>Y</ignoreMissingPath>
    <defaultPathLeafToNull>Y</defaultPathLeafToNull>
    <rownum_field/>
    <file>
      <name/>
      <filemask/>
      <exclude_filemask/>
      <file_required>N</file_required>
      <include_subfolders>N</include_subfolders>
    </file>
    <fields>
      <field>
        <name>id</name>
        <path>$.data.*.id</path>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>xml</name>
        <path>$.data.*.xml</path>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
    </fields>
    <limit>0</limit>
    <IsInFields>Y</IsInFields>
    <IsAFile>N</IsAFile>
    <valueField>result</valueField>
    <shortFileFieldName/>
    <pathFieldName/>
    <hiddenFieldName/>
    <lastModificationTimeFieldName/>
    <uriNameFieldName/>
    <rootUriNameFieldName/>
    <extensionFieldName/>
    <sizeFieldName/>
    <attributes/>
    <GUI>
      <xloc>1488</xloc>
      <yloc>144</yloc>
    </GUI>
  </transform>
  <transform>
    <name>JSON input data</name>
    <type>JsonInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <include>N</include>
    <include_field/>
    <rownum>N</rownum>
    <addresultfile>N</addresultfile>
    <readurl>N</readurl>
    <removeSourceField>N</removeSourceField>
    <IsIgnoreEmptyFile>N</IsIgnoreEmptyFile>
    <doNotFailIfNoFile>Y</doNotFailIfNoFile>
    <ignoreMissingPath>Y</ignoreMissingPath>
    <defaultPathLeafToNull>Y</defaultPathLeafToNull>
    <rownum_field/>
    <file>
      <name/>
      <filemask/>
      <exclude_filemask/>
      <file_required>N</file_required>
      <include_subfolders>N</include_subfolders>
    </file>
    <fields>
      <field>
        <name>id_url</name>
        <path>$.data</path>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
    </fields>
    <limit>0</limit>
    <IsInFields>Y</IsInFields>
    <IsAFile>N</IsAFile>
    <valueField>result</valueField>
    <shortFileFieldName/>
    <pathFieldName/>
    <hiddenFieldName/>
    <lastModificationTimeFieldName/>
    <uriNameFieldName/>
    <rootUriNameFieldName/>
    <extensionFieldName/>
    <sizeFieldName/>
    <attributes/>
    <GUI>
      <xloc>944</xloc>
      <yloc>272</yloc>
    </GUI>
  </transform>
  <transform>
    <name>JSON input next</name>
    <type>JsonInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <include>N</include>
    <include_field/>
    <rownum>N</rownum>
    <addresultfile>N</addresultfile>
    <readurl>N</readurl>
    <removeSourceField>N</removeSourceField>
    <IsIgnoreEmptyFile>N</IsIgnoreEmptyFile>
    <doNotFailIfNoFile>Y</doNotFailIfNoFile>
    <ignoreMissingPath>Y</ignoreMissingPath>
    <defaultPathLeafToNull>Y</defaultPathLeafToNull>
    <rownum_field/>
    <file>
      <name/>
      <filemask/>
      <exclude_filemask/>
      <file_required>N</file_required>
      <include_subfolders>N</include_subfolders>
    </file>
    <fields>
      <field>
        <name>next</name>
        <path>$.page.next</path>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
    </fields>
    <limit>0</limit>
    <IsInFields>Y</IsInFields>
    <IsAFile>N</IsAFile>
    <valueField>result</valueField>
    <shortFileFieldName/>
    <pathFieldName/>
    <hiddenFieldName/>
    <lastModificationTimeFieldName/>
    <uriNameFieldName/>
    <rootUriNameFieldName/>
    <extensionFieldName/>
    <sizeFieldName/>
    <attributes/>
    <GUI>
      <xloc>768</xloc>
      <yloc>416</yloc>
    </GUI>
  </transform>
  <transform>
    <name>JavaScript</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>var base64String = xml;

// Função para decodificação base64
function base64Decode(str) {
  try {
    // Verifica se a string contém apenas caracteres válidos base64
    var regex = /^[A-Za-z0-9+/=]+$/;
    if (!regex.test(str)) {
      throw new Error('Invalid base64 string');
    }

    // Função de decodificação base64
    var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
    var output = '';
    var buffer = '';
    str = str.replace(/=+$/, '');

    for (var i = 0; i &lt; str.length; i++) {
      var c = str.charAt(i);
      buffer += chars.indexOf(c).toString(2).padStart(6, '0');
    }

    for (var j = 0; j &lt; buffer.length; j += 8) {
      var byte = buffer.substr(j, 8);
      if (byte.length === 8) {
        output += String.fromCharCode(parseInt(byte, 2));
      }
    }

    return decodeURIComponent(escape(output));
  } catch (e) {
    throw new Error('Invalid base64 string');
  }
}

// Decodifica a string base64, inicializa decodedString com valor padrão
var decodedString = '';

decodedString = base64Decode(base64String);

// if (base64String !== undefined &amp;&amp; base64String !== null) {
//   decodedString = base64Decode(base64String);
// }

// Atribui a string decodificada a uma nova coluna
decoded_xml = decodedString;
xml = decoded_xml ;



</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>xml</name>
        <rename>xml_decoded</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>Y</replace>
      </field>
    </fields>
    <attributes/>
    <GUI>
      <xloc>1632</xloc>
      <yloc>144</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Merge join</name>
    <type>MergeJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <join_type>FULL OUTER</join_type>
    <keys_1>
</keys_1>
    <keys_2>
</keys_2>
    <transform1>JSON input data</transform1>
    <transform2>Set variables parametros 2</transform2>
    <attributes/>
    <GUI>
      <xloc>1200</xloc>
      <yloc>352</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Parametros API arquivei</name>
    <type>DataGrid</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <data>
      <line>
        <item>834226a523b6b91d7b67a50e8e54c3d20bdfc012</item>
        <item>db609d17d27c9bb58c5a1c04615adf46a5325199</item>
        <item>application/json</item>
      </line>
    </data>
    <fields>
      <field>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
        <name>X-API-ID</name>
      </field>
      <field>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
        <name>X-API-KEY</name>
      </field>
      <field>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
        <name>Content-Type</name>
      </field>
    </fields>
    <attributes/>
    <GUI>
      <xloc>80</xloc>
      <yloc>272</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Parquet File Output arquivei nfse</name>
    <type>ParquetFileOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compression_codec>UNCOMPRESSED</compression_codec>
    <data_page_size>8192</data_page_size>
    <dictionary_page_size>1048576</dictionary_page_size>
    <fields>
      <field>
        <source_field>Numero_NF</source_field>
        <target_field>Numero</target_field>
      </field>
      <field>
        <source_field>CodigoVerificacao</source_field>
        <target_field>CodigoVerificacao</target_field>
      </field>
      <field>
        <source_field>DataEmissao</source_field>
        <target_field>DataEmissao</target_field>
      </field>
      <field>
        <source_field>BaseCalculo</source_field>
        <target_field>BaseCalculo</target_field>
      </field>
      <field>
        <source_field>Aliquota</source_field>
        <target_field>Aliquota</target_field>
      </field>
      <field>
        <source_field>ValorIss</source_field>
        <target_field>ValorIss</target_field>
      </field>
      <field>
        <source_field>ValorLiquidoNfse</source_field>
        <target_field>ValorLiquidoNfse</target_field>
      </field>
      <field>
        <source_field>CpfCnpj</source_field>
        <target_field>CpfCnpj</target_field>
      </field>
      <field>
        <source_field>InscricaoMunicipal</source_field>
        <target_field>InscricaoMunicipal</target_field>
      </field>
      <field>
        <source_field>RazaoSocial</source_field>
        <target_field>RazaoSocial</target_field>
      </field>
      <field>
        <source_field>Endereco</source_field>
        <target_field>Endereco</target_field>
      </field>
      <field>
        <source_field>Numero</source_field>
        <target_field>Numero_1</target_field>
      </field>
      <field>
        <source_field>Bairro</source_field>
        <target_field>Bairro</target_field>
      </field>
      <field>
        <source_field>CodigoMunicipio</source_field>
        <target_field>CodigoMunicipio</target_field>
      </field>
      <field>
        <source_field>Uf</source_field>
        <target_field>Uf</target_field>
      </field>
      <field>
        <source_field>Cep</source_field>
        <target_field>Cep</target_field>
      </field>
      <field>
        <source_field>Contato</source_field>
        <target_field>Contato</target_field>
      </field>
      <field>
        <source_field>DeclaracaoPrestacaoServico</source_field>
        <target_field>DeclaracaoPrestacaoServico</target_field>
      </field>
      <field>
        <source_field>CpfCnpj_tomador</source_field>
        <target_field>CpfCnpj_tomador</target_field>
      </field>
      <field>
        <source_field>RazaoSocial_tomador</source_field>
        <target_field>RazaoSocial_tomador</target_field>
      </field>
      <field>
        <source_field>email_tomador</source_field>
        <target_field>email_tomador</target_field>
      </field>
      <field>
        <source_field>Valor_Servico</source_field>
        <target_field>Valor_Servico</target_field>
      </field>
      <field>
        <source_field>Discriminacao</source_field>
        <target_field>Discriminacao</target_field>
      </field>
    </fields>
    <filename_base>s3://databeautykamico/bronze/arquivei/parket/nfse/arquivo_nfse_${REF_MES_GERAL}_${ID_REF_GERAL}</filename_base>
    <filename_create_parent_folders>Y</filename_create_parent_folders>
    <filename_datetime_format>yyyyMMdd-HHmmss</filename_datetime_format>
    <filename_ext>parquet</filename_ext>
    <filename_include_copy>Y</filename_include_copy>
    <filename_include_date>N</filename_include_date>
    <filename_include_datetime>N</filename_include_datetime>
    <filename_include_split>Y</filename_include_split>
    <filename_include_time>N</filename_include_time>
    <filename_split_size>1000000</filename_split_size>
    <row_group_size>268435456</row_group_size>
    <version>2.0</version>
    <attributes/>
    <GUI>
      <xloc>2480</xloc>
      <yloc>144</yloc>
    </GUI>
  </transform>
  <transform>
    <name>REST client 2</name>
    <type>Rest</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <applicationType>TEXT PLAIN</applicationType>
    <method>GET</method>
    <url>url</url>
    <urlInField>Y</urlInField>
    <dynamicMethod>N</dynamicMethod>
    <methodFieldName/>
    <urlField>url_paginada</urlField>
    <bodyField>body_raw_final</bodyField>
    <httpLogin/>
    <httpPassword>Encrypted </httpPassword>
    <proxyHost/>
    <proxyPort/>
    <preemptive>N</preemptive>
    <trustStoreFile/>
    <trustStorePassword>Encrypted </trustStorePassword>
    <ignoreSsl>N</ignoreSsl>
    <headers>
      <header>
        <field>X-API-ID</field>
        <name>X-API-ID</name>
      </header>
      <header>
        <field>X-API-KEY</field>
        <name>X-API-KEY</name>
      </header>
      <header>
        <field>Content-Type</field>
        <name>Content-Type</name>
      </header>
    </headers>
    <parameters>
      </parameters>
    <matrixParameters>
      </matrixParameters>
    <result>
      <name>result</name>
      <code/>
      <response_time/>
      <response_header/>
    </result>
    <attributes/>
    <GUI>
      <xloc>688</xloc>
      <yloc>272</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Select values</name>
    <type>SelectValues</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>xml</name>
        <rename>xml_decoded</rename>
      </field>
      <select_unspecified>N</select_unspecified>
    </fields>
    <attributes/>
    <GUI>
      <xloc>1872</xloc>
      <yloc>144</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Set variables parametros 1 2</name>
    <type>SetVariable</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <default_value/>
        <field_name>id_url_break</field_name>
        <variable_name>END_LOOP_NFSE</variable_name>
        <variable_type>JVM</variable_type>
      </field>
    </fields>
    <use_formatting>Y</use_formatting>
    <attributes/>
    <GUI>
      <xloc>1792</xloc>
      <yloc>352</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Set variables parametros 2</name>
    <type>SetVariable</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <field_name>next</field_name>
        <variable_name>URL_Next_Arquivei_nfse</variable_name>
        <variable_type>JVM</variable_type>
      </field>
      <field>
        <field_name>id_arquivo</field_name>
        <variable_name>ID_REF_GERAL</variable_name>
        <variable_type>JVM</variable_type>
      </field>
    </fields>
    <use_formatting>Y</use_formatting>
    <attributes/>
    <GUI>
      <xloc>1088</xloc>
      <yloc>416</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Switch / case</name>
    <type>SwitchCase</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <cases>
      <case>
        <target_transform>Calculator</target_transform>
        <value>[]</value>
      </case>
    </cases>
    <default_target_transform>JSON input</default_target_transform>
    <fieldname>id_url</fieldname>
    <use_contains>N</use_contains>
    <attributes/>
    <GUI>
      <xloc>1488</xloc>
      <yloc>352</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Write to log</name>
    <type>WriteToLog</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <loglevel>log_level_basic</loglevel>
    <displayHeader>Y</displayHeader>
    <limitRows>N</limitRows>
    <limitRowsNumber>0</limitRowsNumber>
    <logmessage>Controle de Variável</logmessage>
    <fields>
      <field>
        <name>next</name>
      </field>
      <field>
        <name>id_arquivo</name>
      </field>
      <field>
        <name>url_paginada</name>
      </field>
    </fields>
    <attributes/>
    <GUI>
      <xloc>1344</xloc>
      <yloc>352</yloc>
    </GUI>
  </transform>
  <transform_error_handling>
  </transform_error_handling>
  <attributes/>
</pipeline>
