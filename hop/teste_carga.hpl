<?xml version="1.0" encoding="UTF-8"?>
<pipeline>
  <info>
    <name>teste_carga</name>
    <name_sync_with_filename>Y</name_sync_with_filename>
    <description/>
    <extended_description/>
    <pipeline_version/>
    <pipeline_type>Normal</pipeline_type>
    <parameters>
    </parameters>
    <capture_transform_performance>N</capture_transform_performance>
    <transform_performance_capturing_delay>1000</transform_performance_capturing_delay>
    <transform_performance_capturing_size_limit>100</transform_performance_capturing_size_limit>
    <created_user>-</created_user>
    <created_date>2024/02/21 15:20:35.703</created_date>
    <modified_user>-</modified_user>
    <modified_date>2024/02/21 15:20:35.703</modified_date>
  </info>
  <notepads>
  </notepads>
  <order>
    <hop>
      <from>Select values</from>
      <to>Parquet Pedidos Status_Uno</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Staus_Pedido_Varejo_UNO</from>
      <to>Select values</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <transform>
    <name>Parquet Pedidos Status_Uno</name>
    <type>ParquetFileOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compression_codec>UNCOMPRESSED</compression_codec>
    <data_page_size>8192</data_page_size>
    <dictionary_page_size>1048576</dictionary_page_size>
    <fields>
      <field>
        <source_field>dt_implante_pedido</source_field>
        <target_field>dt_implante_pedido</target_field>
      </field>
      <field>
        <source_field>dt_faturamento</source_field>
        <target_field>dt_faturamento</target_field>
      </field>
      <field>
        <source_field>dt_cancelamento</source_field>
        <target_field>dt_cancelamento</target_field>
      </field>
      <field>
        <source_field>dt_alteracao</source_field>
        <target_field>dt_alteracao</target_field>
      </field>
      <field>
        <source_field>cod_pedido</source_field>
        <target_field>cod_pedido</target_field>
      </field>
      <field>
        <source_field>cod_cliente</source_field>
        <target_field>cod_cliente</target_field>
      </field>
      <field>
        <source_field>situacao_pedido</source_field>
        <target_field>situacao_pedido</target_field>
      </field>
      <field>
        <source_field>descricao</source_field>
        <target_field>descricao</target_field>
      </field>
      <field>
        <source_field>desc_abreviada</source_field>
        <target_field>desc_abreviada</target_field>
      </field>
      <field>
        <source_field>cfop</source_field>
        <target_field>cfop</target_field>
      </field>
      <field>
        <source_field>empresa</source_field>
        <target_field>empresa</target_field>
      </field>
      <field>
        <source_field>uf_faturamento</source_field>
        <target_field>uf_faturamento</target_field>
      </field>
      <field>
        <source_field>qtd_itens</source_field>
        <target_field>qtd_itens</target_field>
      </field>
      <field>
        <source_field>qtd_sku</source_field>
        <target_field>qtd_sku</target_field>
      </field>
      <field>
        <source_field>qtd_marcas</source_field>
        <target_field>qtd_marcas</target_field>
      </field>
      <field>
        <source_field>vlr_pedido</source_field>
        <target_field>vlr_pedido</target_field>
      </field>
    </fields>
    <filename_base>s3://databeautykamico/silver/parquet/varejo/Pedidos_Status/Pedidos_Status</filename_base>
    <filename_create_parent_folders>Y</filename_create_parent_folders>
    <filename_datetime_format>yyyyMMdd-HHmmss</filename_datetime_format>
    <filename_ext>parquet</filename_ext>
    <filename_include_copy>Y</filename_include_copy>
    <filename_include_date>N</filename_include_date>
    <filename_include_datetime>N</filename_include_datetime>
    <filename_include_split>Y</filename_include_split>
    <filename_include_time>N</filename_include_time>
    <filename_split_size>1000000</filename_split_size>
    <row_group_size>268435456</row_group_size>
    <version>2.0</version>
    <attributes/>
    <GUI>
      <xloc>864</xloc>
      <yloc>80</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Select values</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <select_unspecified>N</select_unspecified>
      <meta>
        <name>dt_implante_pedido</name>
        <rename>dt_implante_pedido</rename>
        <type>Date</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask>yyyy-MM-dd</conversion_mask>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>dt_faturamento</name>
        <rename>dt_faturamento</rename>
        <type>Date</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask>yyyy-MM-dd</conversion_mask>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>dt_cancelamento</name>
        <rename>dt_cancelamento</rename>
        <type>Date</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask>yyyy-MM-dd</conversion_mask>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>dt_alteracao</name>
        <rename>dt_alteracao</rename>
        <type>Date</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask>yyyy-MM-dd</conversion_mask>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>cod_pedido</name>
        <rename>cod_pedido</rename>
        <type>None</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>cod_cliente</name>
        <rename>cod_cliente</rename>
        <type>None</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>situacao_pedido</name>
        <rename>situacao_pedido</rename>
        <type>None</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>descricao</name>
        <rename>descricao</rename>
        <type>None</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>desc_abreviada</name>
        <rename>desc_abreviada</rename>
        <type>None</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>cfop</name>
        <rename>cfop</rename>
        <type>None</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>empresa</name>
        <rename>empresa</rename>
        <type>None</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>uf_faturamento</name>
        <rename>uf_faturamento</rename>
        <type>None</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>qtd_itens</name>
        <rename>qtd_itens</rename>
        <type>Integer</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>qtd_sku</name>
        <rename>qtd_sku</rename>
        <type>Integer</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>qtd_marcas</name>
        <rename>qtd_marcas</rename>
        <type>Integer</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>vlr_pedido</name>
        <rename>vlr_pedido</rename>
        <type>Number</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
    </fields>
    <attributes/>
    <GUI>
      <xloc>480</xloc>
      <yloc>80</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Staus_Pedido_Varejo_UNO</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>Athena_AWS_Kami</connection>
    <execute_each_row>N</execute_each_row>
    <limit>0</limit>
    <sql>
select 
    case 
        when dt_implante_pedido is not null and try(date_parse(dt_implante_pedido, '%Y-%m-%d %H:%i:%s')) is not null 
        then date(try(date_parse(dt_implante_pedido, '%Y-%m-%d %H:%i:%s'))) 
        else null 
    end as dt_implante_pedido,
    case 
        when dt_faturamento is not null and try(date_parse(dt_faturamento, '%Y-%m-%d %H:%i:%s')) is not null 
        then date(try(date_parse(dt_faturamento, '%Y-%m-%d %H:%i:%s'))) 
        else null 
    end as dt_faturamento,
    case 
        when dt_cancelamento is not null and try(date_parse(dt_cancelamento, '%Y-%m-%d %H:%i:%s')) is not null 
        then date(try(date_parse(dt_cancelamento, '%Y-%m-%d %H:%i:%s'))) 
        else null 
    end as dt_cancelamento,
    case 
        when dt_alteracao is not null and try(date_parse(dt_alteracao, '%Y-%m-%d %H:%i:%s')) is not null 
        then date(try(date_parse(dt_alteracao, '%Y-%m-%d %H:%i:%s'))) 
        else null 
    end as dt_alteracao,
    p.cod_pedido,
    p.cod_cliente,
    situacao_pedido,
    descricao,
    desc_abreviada,
    desc_abrev_cfop as cfop,
    faturamento_empresa_fantasia empresa,
    uf_empresa_faturamento as uf_faturamento,
    count(p.cod_produto) qtd_itens,
    count(distinct p.cod_produto) qtd_sku,
    count(distinct p.marca) qtd_marcas,
    sum(preco_desconto_rateado) vlr_pedido
from databeautykami.tbl_varejo_pedidos p 
where situacao_pedido not in ('0', '1', '15') 
  and dt_implante_pedido is not null 
  and try(date_parse(dt_implante_pedido, '%Y-%m-%d %H:%i:%s')) >= date('2023-01-01') 
group by 
    dt_implante_pedido,
    dt_faturamento,
    dt_cancelamento,
    dt_alteracao,
    p.cod_pedido,
    p.cod_cliente,
    situacao_pedido,
    descricao,
    desc_abreviada,
    desc_abrev_cfop,
    faturamento_empresa_fantasia,
    uf_empresa_faturamento;</sql>
    <variables_active>N</variables_active>
    <attributes/>
    <GUI>
      <xloc>96</xloc>
      <yloc>80</yloc>
    </GUI>
  </transform>
  <transform_error_handling>
  </transform_error_handling>
  <attributes/>
</pipeline>
